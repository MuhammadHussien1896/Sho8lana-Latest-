@model ServicesCategoriesViewModel
@{
    ViewData["Title"] = "Services";
    pagination pager = new pagination();
    int pageNo = 0;
    if (ViewBag.pager != null)
    {
        pager = ViewBag.pager;
        pageNo = pager.CurrentPage;
    }
    var trustedSeller = (TempData["Trusted"]?.ToString());
    var CatId = (TempData["category"]?.ToString())??ViewBag.Id;
    int rate;
    int Price;
    int.TryParse((TempData["Rate"]?.ToString()),out rate);
    var res=int.TryParse((TempData["Price"]?.ToString()),out Price);
    Price = (res == false ? int.MaxValue : Price);
    trustedSeller = (trustedSeller == null ? "false" : "true");
    CatId = (CatId == null ? 0 : CatId);
    var text = ViewBag.Text;
}
    <section id="services" class="services section-bg pt-3 row" style="direction:rtl">
        <div class="col-12 d-flex justify-content-around" data-aos="fade-up">
            <div class="section-title">
                <h2>خدماتنا</h2>
                <p> أحصل على أفضل الخدمات بأفضل الأسعار</p>
            </div>
        </div>
            <div class="col-12 my-5 d-flex justify-content-center">
                <form asp-action="Hiring" asp-controller="Categories"  asp-route-id="@CatId">
                <input type="checkbox" checked data-toggle="toggle" data-on="خدمات" data-off="طلبات"
                    data-onstyle="success" data-offstyle="primary" id="checkbox">
                </form>            
                </div>
            <div class="col-2" style="direction:rtl">
                 <div class="d-flex flex-column flex-shrink-0 mb-5 icon-box iconbox-blue w-100" style="width: 280px;direction:rtl">
                    <a href="/" class="d-flex align-items-center justify-content-center link-dark text-decoration-none">
                      <span class="fs-4">خدماتنا</span>
                    </a>
<!-- ========================= Search Form Section ============================= -->
                    <form asp-action="search" method="get">
                        <input type="hidden" value="true" name="type" />
                        <input type="Text" value="@text" name="text" class="form-control my-3" placeholder="أكتب ماتريد البحث عنه">
                        <select class="form-select text-center selectCategories" name="CatId" size="8" aria-label="size 3 select example">
                        @{
                            foreach (var item in Model.categories)
                            {
                                <option value="@item.CategoryId" class="CategoryOptions">@item.Name</option>    
                            }
                        }
                        </select>
                            <div style="direction:rtl">
                                <div class="my-3">
                                     الترتيب حسب التقييم 
                                </div>
                                @{
                                    for (var i = 0; i < 5; i++)
                                    {
                                        if (i == 0)
                                        {
                               <div class="form-check col-12">
                                  <input class="form-check-input ms-0 float-none" type="radio" name="Rate" id="gridRadios1" value="10">
                                  <label class="form-check-label fw-bold ratings" for="gridRadios1">
                                      @{
                                          for (var j = 0; j < 5; j++)
                                          {
                                            <i class="fa fa-star rating-color"></i>   
                                          }
                                      }
                                  </label>
                                </div>
                            }
                            else
                            {
                                  <div class="form-check col-12">
                                  <input class="form-check-input ms-0 float-none" type="radio" name="Rate" id="gridRadios2" value="@(10-2*i)">
                                  <label class="form-check-label fw-bold ratings" for="gridRadios2">
                                        @{
                                            for (var j = 0; j < i; j++)
                                            {
                                                <i class="fa fa-star ratinglow"></i>   
                                            }
                                            for (var j = 0; j < 5-i; j++)
                                            {
                                                <i class="fa fa-star rating-color"></i>   
                                            }
                                        }
                                  </label>
                                </div>  
                           }}}
                      </div>
                      <div>
                          <div class="my-3" >الترتيب حسب السعر</div>
                          <select class="my-3 form-select PriceSelect"   name="Price" >
                              <option value="negogation">غير محدد</option>
                              <option value="5">5$</option>
                              <option value="10">10$</option>
                              <option value="15">15$</option>
                              <option value="20">20$</option>
                              <option value="@int.MaxValue">غير محدود</option>
                          </select>
                      </div>
                      <div class=row>
                            <div class="form-check col-12 my-3">
                                <input class="form-check-input ms-0 float-none trustseller" type="checkbox" name="Truste" value="true" id="flexCheckDefault">
                                <label class="form-check-label fw-bold" for="flexCheckDefault">
                                    بائع موثوق           
                                </label>
                            </div>
                      </div>
                            <input class="btn btn-primary" type="submit" />
                </form>
<!---------------------------- End Of Search Form Seaction ----------------------------------------->

            </div>
            </div>
<!-- ========================= Services Section ============================= -->
            <div class="col-10" >
                <div class="card-deck row justify-content-around">
            @{
                foreach (var service in Model.services)
                {
                    <div class="card col-lg-3 col-md-4 col-sm-6 border-0 my-5 px-2 bg-light">
                        <div class="position-relative">
                            <a asp-action="Details" asp-controller="Service" asp-route-id="@service.ServiceId">
                                @{
                                    if (@service.Medias.FirstOrDefault()!=null)
                                        {
                                             <img class="card-img-top" src="~/Images/CategoriesImage/@service.Medias.FirstOrDefault().MediaPath">
                                        }
                                    else
                                        {
                                            <img class="card-img-top" src="~/Images/Defaultimage/defaultService.jpg">
                                        }
                                }
                            </a>
                            @{
                                if (@service.Customer.ProfilePicture == null)
                                {
                                    <img src="~/Images/DefaultImage/UserDefaultImage.png" class="position-absolute bottom-0 start-0 rounded-circle w-25 bg-light" />
                                }
                                else
                                {
                                    <img src="data:image/*;base64,@Convert.ToBase64String(@service.Customer.ProfilePicture)" class="position-absolute bottom-0 start-0 rounded-circle w-25 bg-light" />
                                }
                            }
                         </div>
                         <div class="card-body">
                            <p class="card-title mb-3 fw-bold">@service.Title</p>
                            <div style="text-align:start;direction:rtl">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="ratings me-0"> 
                                        @{
                                            for (var i = 0; i < (int)5-@service.Rate/2; i++)
                                            {
                                                <i class="fa fa-star"></i>   
                                            }
                                            for (var i = 0; i < (int)@service.Rate/2; i++)
                                            {
                                                <i class="fa fa-star rating-color"></i> 
                                            }
                                        }
                                    </div>
                                </div>
                                <div class="fw-normal">تبدأ من : <span class="fw-bold">@service.Price $</span></div>
                                    @{
                                        if (@service.IsCash)
                                        {
                                            <div class="fw-bold">متاح التعامل بالكاش او الفيزا</div>
                                        }
                                        else
                                        {
                                            <div class="fw-bold">متاح التعامل بالفيزا فقط </div>
                                        }
                                    }
                                <div class="fw-normal"> عدد المشترين :<span class="fw-bold">@service.Contracts.Where(c => c.IsDone).Count()</span></div>
                                <div class="fw-normal">تاريخ النشر :<span class="fw-bold">@service.PublishDate.ToString("MM/dd/yyyy")</span></div>
                            </div>
                         </div>
                     </div>                
                }
            }
                </div>
            </div>
<!---------------------------- End Of Search Form Seaction ----------------------------------------->
        </div>
    </section>
<!-- ========================= Paging Section ============================= -->
    <div class="row bg-light">
    @if (pager.TotalPages > 0)
    {
        <ul class="pagination justify-content-center">
            @if (pager.CurrentPage>1)
            {
                <li class="page-item">
                    <a class="page-link" asp-controller="Categories" asp-action="index" asp-route-id="@ViewBag.Id" asp-route-pg="1">
                        First
                    </a>
                </li> 
                <li>
                    <a class="page-link" asp-controller="Categories" asp-action="index" asp-route-id="@ViewBag.Id" asp-route-pg="@pager.CurrentPage-1">
                        Previous
                    </a>
                </li>   
            }
            @for (var i = 1; i <= pager.EndPage; i++)
            {
                <li class="page-item @(i==pager.CurrentPage?"active":" ")">
                     <a class="page-link" asp-controller="Categories" asp-action="index" asp-route-id="@ViewBag.Id" asp-route-pg="@i">
                        @i
                     </a>
                </li>  
            }
            @if (pager.CurrentPage<pager.TotalPages)
            {
                <li class="page-item">
                    <a class="page-link" asp-controller="Categories" asp-action="index" asp-route-id="@ViewBag.Id" asp-route-pg="@pager.CurrentPage+1">
                        Next
                    </a>
                </li> 
                <li>
                      <a class="page-link" asp-controller="Categories" asp-action="index" asp-route-id="@ViewBag.Id" asp-route-pg="@pager.TotalPages">
                        Last
                      </a>
                </li>   
            }

        </ul>
    }

    </div>
<!---------------------------- End Paging Seaction ----------------------------------------->
    <script>
        document.querySelector(".trustseller").checked=@trustedSeller;
        document.querySelector(".PriceSelect").value=@Price;
        let ele= document.getElementById("checkbox");
        ele.onchange=()=>{setTimeout(()=>{ele.form.submit()
           },500)};
        document.querySelector(".selectCategories").value=@CatId;
        let radios=document.querySelectorAll(`[name="Rate"]`);
        for(let i=0;i<=radios.length;i++){
            if(@rate==0){
               }
               else if(@rate==radios[i].value)
               {
                   radios[i].checked=true;
                   break;
               }
        };
    </script>